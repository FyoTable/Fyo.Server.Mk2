<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Fyo Game Table - Base Controller</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

        <!-- Specific to this controller -->
        <link rel="stylesheet" href="/base_controller/base_styles.css">
    </head>
    <body>
        <div id="mainContainer">        
            <!-- Specific to this controller -->
            <div class="text-lcd toolbar" style="position: absolute; top: 0px; right: 0px; left: 0px; z-index: 0">
                <img src="" style="display:none;" id="profilePic" />
                <span id="text-message">PLAYER</span></div>

                <button id="test-button" style="margin-top: 100px">MSG TEST</button>
        </div>

        <!-- Socket.io is required for FyoGameTable -->
        <script src="/socket.io/socket.io.js"></script>

        <script type="text/javascript">
            var exports = {};
        </script>
        <script src="/modernizr-custom.js"></script>
        <script type="module" src="/fyo-web.js"></script>

        <!-- Controller specific setup -->
        <script type="module">

            var playerId = 0;

            var connecter = new FYO.FyoConnection(io, 'base_controller');
            // connecter.AddVisualLatency();
            
            // function fill() {
            //     connecter.socket.emit('ack');
            //     setTimeout(fill, 10);
            // }
            // fill();

            ////////////////////////////////
            ///  MessageType Handlers
            ////////////////////////////////

            function GameStarted(data) {
                playerId = data.PlayerId;
                if (data.Primary) {
                    document.getElementById('text-message').innerText = 'PRIMARY ' + data.PlayerId;
                } else {
                    document.getElementById('text-message').innerText = 'PLAYER ' + data.PlayerId;
                }
            }
            // Messages from the Node Server (which originated from the game)
            connecter.on('SGUpdateMsg', function (data) {
                switch (data.MessageType) {
                    case 'GameStarted':
                        GameStarted(data.data);
                        break;
                    case 'PrimaryControl':
                        document.getElementById('text-message').innerText = 'PRIMARY ' + playerId;
                        break;
                }
            });

            document.getElementById('test-button').addEventListener('click', function() {
                console.log('Emit SGUpdateMsg');
                connecter.socket.emit('SGUpdateMsg', { MessageType: 'TestMessage', data: { Message: 'Hello World' } });
            });

        </script>

    </body>
</html>
